# Django Reference

This repository holds the source code of a **reference** for the development of a **REST API with graphql support** based on Django framework

## Table of content

-   [Project structure](#project-structure)
-   [Installation](#installation)
    -   [Pre-requisites](#pre-requisites)
    -   [Initial setup](#initial-setup)
    -   [Database filling](#database-filling)
-   [Execution](#execution)
    -   [Examples](#examples)
-   [Testing](#testing)
-   [Seed-Builder](#seed-builder)
    -   [Extend modules](#extend-modules)
-   [Deployment](#deployment)
    

## Project structure

-   /app: General settings of the application.
    -   settings.py: Django settings (Eg. Installed modules, global vars, etc).
-   **/domain**: Business logic methods. [Details](./domain/README.md)
-   **/routes**: Api routes extensions (Custom endpoints definitions). [Details](./routes/README.md)
-   /models: Model extensions. [Details](./models/README.md)
    -   /fixtures: Initial data inserts (Eg. dummy data and catalogs). [Details](https://docs.djangoproject.com/en/3.1/howto/initial-data/)
-   /tests: Test cases of the application.
-   /seed: Autogenerated files produced by seed-builder: It includes model definitions, CRUD endpoint creation, serializers and graphql implementation
    >   These files are *read-only*, modifiable only through seed-builder [Details](#seed-builder)


## Installation

### Pre-requisites

-   Download & install [Python3](https://www.python.org/downloads/)
-   Download & install [PostgreSQL](https://www.postgresqltutorial.com/postgresql-getting-started/)
-   Download & install [PyCharm CE](https://www.jetbrains.com/pycharm/download/) (optional)
>   To facilitate development it is recommended to run the project on a debian distribution (Eg. ubuntu)

### Initial setup

-   Clone this repository.
-   Execute install script
```bash
./bin/setup.sh <DB_NAME> <DB_USER> <DB_PASSWORD>
```
>   For windows, run the install.sh commands manually

-   Optionally configure .env.dev fields with server attributes, database connections, secret keys, etc.

### Database filling

-   Load fixtures (initial data).
```bash
python3 manage.py loaddata models/fixtures/*.yaml
```
>  For windows, each .yaml file has to be executed one by one. It is recommended to implement an execution script (eg. run-all-fixtures.bat)


## Execution

-   Run server.
```bash
python3 manage.py runserver
```

### Examples

-   Execute an API request.
```bash
POST http://localhost:8000/api/players
```

-   Open graphql browser.
```bash
http://localhost:8000/graphql
```

-   Open admin pane.
```bash
http://localhost:8000/admin
```
>   To access admin pane, create a user fixture with the *is_superuser* attribute set to true 


## Testing

-   Test use cases
```bash
python3 manage.py test
```

-   Analyze code coverage
```bash
coverage run --omit='.venv/*,bin/*,tests/*,*__init__*' manage.py test
coverage report -m
```

## Seed-Builder

>   Seed-builder is a code generator framework to reduce *boilerplate code* required by the application (Eg. model definitions, CRUD API creation, graphql implementation) 

To create or update seed-builder autogenerated files.

-   Create or update SeedManifest.json file using StarUML extension [See documentation](https://github.com/erick-rivas/seed-staruml/blob/master/README.md).
-   Install builder.
```bash
npm install -g seed-builder
``` 
-   Run builder.
```bash
seed-builder
``` 
>   It automatically detect the project settings described in SeedManifest.json and update or create the required files

### Extend modules

In case of extend the functionality of autogenerated resources (Eg. Add a custom endpoint, edit a model str() method, etc). Use *seed-builder extend* command, Examples:

-   To extend a model.
```bash
seed-builder extend -m models:<model_name>
``` 

-   To extend a route.
```bash
seed-builder extend -m routes:<model_name>
``` 
>   when extending a module a new file will be generated in the module folder (Eg. models/player.py)


## Deployment

### AWS - Elastic Beanstalk

To deploy application to aws-eb see [Deployment guide (single-instance)](./bin/aws-eb/single-instance/deployment.md) or [Deployment guide (load-balancer)](./bin/aws-eb/load-balanced/deployment.md)

### Ubuntu Server (Debian)

To deploy application to a Ubuntu Server (Debian) see [Deployment guide](./bin/ubuntu/deployment.md).

### Docker

To deploy application using docker see [Deployment guide](./bin/docker/deployment.md).