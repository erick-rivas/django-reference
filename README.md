# Django Reference

This repository holds the source code of the **seed-reference** for the development of a **Django API** written mainly in python.

## Table of content

-   [Overview](#overview)
-   [Pre-requisites](#pre-requisites)
-   [Installation](#installation)
    -   [Run project](#run-project)
    -   [Filling of database](#filling-of-database)
    -   [Test running](#test-running)
-   [Examples](#examples)
-   [Seed-Builder](#seed-builder)
    -   [Extend modules](#extend-modules)
-   [Deployment](#deployment)
    
## Overview

The reference uses an REST API architecture based on [Django framework](https://www.djangoproject.com), [Django REST framework](https://www.django-rest-framework.org) and [Graphene-Django](https://docs.graphene-python.org/projects/django/en/latest/).

In general terms, the architecture uses the following structure:

-   /app: General settings of the application.
    -   settings.py: Django settings (Eg. Installed modules, global vars, etc).
-   **/domain**: Business logic methods. [Details](./domain/README.md).
-   **/routes**: Api routes extensions (Custom endpoints definitions). [Details](./routes/README.md).
-   /models: Model extensions. [Details](./models/README.md).
    -   /fixtures: Initial data inserts (Eg. dummy data and catalogs). [Details](https://docs.djangoproject.com/en/3.1/howto/initial-data/)
-   /tests: Test cases of the application.
-   /seed: Autogenerated files produced by seed-builder: It includes model definitions, CRUD endpoint creation, serializers and graphql implementation
    >   These files are *read-only*, modifiable only through seed-builder [Details](#seed-builder)

## Pre-requisites

-   Download & install [Python3](https://www.python.org/downloads/).
-   Download & install [PostgreSQL](https://www.postgresqltutorial.com/postgresql-getting-started/).
-   Download & install [PyCharm CE](https://www.jetbrains.com/pycharm/download/) (optional).
>   To facilitate development it is recommended to run the project on debian distribution (Eg. ubuntu)


## Installation

-   Clone this repository.
-   Create & activate a virtual environment
```bash
python3 -m venv .venv
. .venv/bin/activate
```

-  Install dependencies
```bash
pip3 install -r requirements.txt
```

-   Create a new postgresql database.
-   Copy .env.example and paste it renaming to .env.dev (development environment) or .env.prod (production environment)
-   Configure .env fields with server attributes, database connections, secret keys, etc.

-   Make database migrations.
```bash
python3 manage.py makemigrations
```

-   Execute migrations.
```bash
python3 manage.py migrate
```

-   Run project.
```bash
python3 manage.py runserver
```

### Filling of database 

-   Load fixtures (initial data).
```bash
python3 manage.py loaddata models/fixtures/*.yaml
```
>  For windows, each .yaml file has to be executed one by one. It is recommended to implement an execution script (eg. run-all-fixtures.bat)

## Examples

-   Execute an API request.
```bash
POST http://localhost:8000/api/players
```

-   Open graphql browser.
```bash
http://localhost:8000/graphql
```

-   Open admin pane.
```bash
http://localhost:8000/admin
```
>   To access admin pane, create a user fixture with the *is_superuser* attribute set to true 

## Seed-Builder

>   Seed-builder is a code generator framework to reduce *boilerplate code* required by the application (Eg. model definitions, CRUD API creation, graphql implementation) 

To create or update seed-builder autogenerated files.

-   Create or update SeedManifest.json file using StarUML extension [See documentation](https://github.com/erick-rivas/seed-staruml/blob/master/README.md).
-   Install builder.
```bash
npm install -g seed-builder
``` 
-   Run builder.
```bash
seed-builder
``` 
>   It automatically detect the project settings described in SeedManifest.json and update or create the required files

### Extend modules

In case of extend the functionality of autogenerated resources (Eg. Add a custom endpoint, edit a model str() method, etc). Use *seed-builder extend* command, Examples:

-   To extend a model.
```bash
seed-builder extend -m models:<model_name>
``` 

-   To extend a route.
```bash
seed-builder extend -m routes:<model_name>
``` 
>   when extending a module a new file will be generated in the module folder (Eg. models/player.py)

## Deployment

### AWS - Elastic Beanstalk

To deploy application to aws-eb see [Deployment guide (single-instance)](./bin/aws-eb/single-instance/deployment.md) or [Deployment guide (load-balancer)](./bin/aws-eb/load-balanced/deployment.md)

### Ubuntu Server (Debian)

To deploy application to a Ubuntu Server (Debian) see [Deployment guide](./bin/ubuntu/deployment.md).

### Docker

To deploy application using docker see [Deployment guide](./bin/docker/deployment.md).