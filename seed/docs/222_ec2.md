## AWS EC2

### Before start

Before start implementing, check [ubuntu setup](220_ubuntu.md)

### Install AWS CLI

Execute the followings commands:

```bash
sudo apt install unzip
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

Copy seed/docs/assets/aws-ec2/.env.example to root project and rename to **.aws.env**. 
Then add secret AWS keys (you can create an IAM user or get them from Account >> Security Credentials)
-   AWS_ACCESS_KEY_ID
-   AWS_SECRET_ACCESS_KEY

Note: if you need to specify a region, modify also REGION and BUCKET_NAME (get BUCKET_NAME and region identifier from [https://docs.aws.amazon.com/codedeploy/latest/userguide/resource-kit.html#resource-kit-bucket-names](https://docs.aws.amazon.com/codedeploy/latest/userguide/resource-kit.html#resource-kit-bucket-names))

Then execute `seed/docs/assets/aws-ec2/configure.sh` to set cli keys

### Configure

Modify next variables in .aws.env located at root project:
-   INSTANCE_ID # Server instance id (get it from EC2 panel)
-   INSTANCE_NAME # Server instance name (get it from EC2 panel)
-   PROJECT_NAME # Custom name (custom name like reference-api)

### Available commands

Available commands are:

-   `seed/docs/assets/aws-ec2/ec2.sh start` # Start server
-   `seed/docs/assets/aws-ec2/ec2.sh stop` # Stop server, you can't access once it's stopped
-   `seed/docs/assets/aws-ec2/ec2.sh restart` # Restart server
-   `seed/docs/assets/aws-ec2/ec2.sh allocate-ip` # Allocate an elastic ip and associate it to server

### Creating Route53 subdomain

Before this, it's needed to have an allocated ip.

- Go to Route53 panel and create a new hosted zone. Then select and edit it, copy hosted zone id. 
- Modify next variables in .aws.env located at root project:
    -   DOMAIN # Registered domain in hosted zone (get it from Route53 panel)
    -   HOSTED_ZONE_ID # ID of hosted zone previously copied (get it from Route53 panel)
- Then execute `seed/docs/assets/aws-ec2/ec2.sh create-subdomain` which create a subdomain like <PROJECT_NAME>.<HOSTED_ZONE_DOMAIN>